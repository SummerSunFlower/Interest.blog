{% extends "base/front.html" %}

{% block title %}Interest Blog Index | SaintIC{% endblock %}

{% if g.plugins['BaiduStatistics'] %}
{% block head %}
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?88f6d909dd0d8f80bb9748f43ade3ac7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
{% endblock %}
{% endif %}

{% block content %}

  <div class="home">
    <h1 class="page-heading">
        <a href="{{ url_for('.index', tab='all') }}" title="所有文章">所有文章</a><span class="badge green" id="index_number"></span>&nbsp;
        <a href="{{ url_for('.index', tab='update') }}" title="所有更新文章">最近更新</a><span class="badge yellow" id="update_number"></span>&nbsp;
        <a href="{{ url_for('.index', tab='hot') }}" title="最新十篇热评文章">热评文章</a><span class="badge red" id="hot_number"></span>
    </h1>
    <hr /><br />
    <ul class="post-list" id="article">
      <!--
      <li>
        <span class="post-meta">Jan 1, 2016</span>
        <h2>
          <a class="post-link" href="/blog">固定文章索引</a>
        </h2>
      </li>
      -->
    </ul>
  </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
        // 获取所有文章索引
        $.ajax({
            url: "{{ g.apiurl }}/blog?get_index_only=true&sort=desc&limit=all",
            method: 'GET',
            datatype: 'json',
            success: function(res) {
                console.log(res);
                var data= res.data;
                var str = '';
                for(i=0; i<data.length; i++) {
                    blog = data[i];
                    str += '<li><span class="post-meta">' + blog.create_time + '</span><h2><a class="post-link" href="/blog/' + blog.id + '.html">' + blog.title + '</a></h2></li>';
                };
                document.getElementById('index_number').innerHTML=data.length;
                {%- if request.args.get("tab", "all") == "all" %}
                document.getElementById('article').innerHTML=str;
                console.log("index all");
                {% endif %}
            },
            error: function(error){
                console.log(error);
                alert("所有文章数据获取错误，请尝试刷新重试！");
            }
        });
        // 获取所有更新文章索引
        $.ajax({
            url: "{{ g.apiurl }}/blog?get_update_data=true&sort=desc&limit=all",
            method: 'GET',
            datatype: 'json',
            success: function(res) {
                console.log(res);
                var data= res.data;
                var str = '';
                for(i=0; i<data.length; i++) {
                    blog = data[i];
                    str += '<li><span class="post-meta">' + blog.update_time + '</span><h2><a class="post-link" href="/blog/' + blog.id + '.html">' + blog.title + '</a></h2></li>';
                };
                document.getElementById('update_number').innerHTML=data.length;
                {%- if request.args.get("tab", "all") == "update" %}
                document.getElementById('article').innerHTML=str;
                console.log("index update");
                {% endif %}
            },
            error: function(error){
                console.log(error);
                alert("最近更新数据获取错误，请尝试刷新重试！");
            }
        });
        // 获取10篇热评文章索引
        $.ajax({
            url: "http://api.duoshuo.com/sites/listTopThreads.jsonp?short_name={{ g.plugins['DuoshuoComment']['shortName'] }}&range=all&num_items=10",
            method: 'GET',
            datatype: 'json',
            success: function(res) {
                console.log(res);
                var data= res.response;
                var str = '';
                for(i=0; i<data.length; i++) {
                    blog = data[i];
                    str += '<li><span class="post-meta">' + blog.created_at + '</span><h2><a class="post-link" href="' + blog.url + '">' + blog.title + '</a></h2></li>';
                };
                document.getElementById('hot_number').innerHTML=data.length;
                {%- if request.args.get("tab", "all") == "hot" %}
                document.getElementById('article').innerHTML=str;
                console.log("index hot");
                {% endif %}
            },
            error: function(error){
                console.log(error);
                alert("热评文章数据获取错误，请尝试刷新重试！");
            }
        });
    </script>
{% endblock %}
